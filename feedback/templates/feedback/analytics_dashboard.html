{% extends 'feedback/base.html' %}

{% block title %}Analytics Dashboard{% endblock %}

{% block content %}
<div class="header">
    <h1>Analytics Dashboard</h1>
    <p>Comprehensive feedback insights and trends</p>
</div>

{% for block in grouped_data %}
<div class="card">
    <h2>{{ block.stakeholder|title }} Feedback Analysis</h2>

    <h3>Rating-Based Questions</h3>
    {% if block.rating_data %}
    <table>
        <thead>
            <tr>
                <th>Question</th>
                <th>Category</th>
                <th style="text-align: center;">Average Rating</th>
            </tr>
        </thead>
        <tbody>
            {% for row in block.rating_data %}
            <tr>
                <td>{{ row.question }}</td>
                <td><span style="background: #e2e8f0; padding: 5px 12px; border-radius: 15px; font-size: 0.9rem;">{{ row.category }}</span></td>
                <td style="text-align: center;">
                    {% if row.avg_rating >= 4 %}
                    <strong style="color: #48bb78; font-size: 1.1rem;">{{ row.avg_rating }}/5</strong>
                    {% elif row.avg_rating >= 3 %}
                    <strong style="color: #ed8936; font-size: 1.1rem;">{{ row.avg_rating }}/5</strong>
                    {% else %}
                    <strong style="color: #f56565; font-size: 1.1rem;">{{ row.avg_rating }}/5</strong>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="alert alert-info">
        No rating data available yet.
    </div>
    {% endif %}

    <h3>Multiple Choice Questions</h3>
    {% if block.mcq_data %}
        {% for q in block.mcq_data %}
        <h4>{{ q.question }} <span style="color: #666; font-size: 0.9rem; font-weight: normal;">({{ q.category }})</span></h4>
        <table>
            <thead>
                <tr>
                    <th>Option</th>
                    <th style="text-align: center;">Responses</th>
                    <th style="text-align: center;">Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for opt in q.options %}
                <tr>
                    <td>{{ opt.option }}</td>
                    <td style="text-align: center;"><strong>{{ opt.count }}</strong></td>
                    <td style="text-align: center;">
                        <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 5px 15px; border-radius: 15px; font-weight: 600;">
                            {{ opt.percent }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endfor %}
    {% else %}
    <div class="alert alert-info">
        No MCQ data available yet.
    </div>
    {% endif %}
</div>
{% endfor %}

<div style="text-align: center; margin-top: 2rem;">
    <a href="{% url 'home' %}" class="btn btn-secondary">‚Üê Back to Home</a>
</div>
{% endblock %}